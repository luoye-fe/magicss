/*
 * Magicss v1.0.0
 * (c) 2016 luoye <842891024@qq.com>
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Magicss=t()}(this,function(){"use strict";function e(e){function t(t){return u=t?u+t:++u,l=e.charAt(u),l||""}function n(){return e.charAt(u+1)||""}function r(){var n=e.substr(u),r=n.match(f.comment)[0];for(t(r.length);/\s|\n/.test(l);)r+=l,t();var o={};if(f.ruleOptionInComment.test(r)){var i=r.match(f.ruleOptionInComment)[1];o=a(i)}s.push({type:"comment",comment:r.replace(f.ruleOptionInComment,""),options:o})}function o(){var n=e.substr(u),r=n.match(f.selector)[1];t(r.length);var o=i();s.push({type:"common",selector:r.replace(f.bothWhiteSpace,""),options:o.options,style:o.style})}function i(){var n=e.substr(u),r=n.match(f.allRules)[1],o={},i={};if(t(r.length),f.comment.test(r)){var c=r.match(f.comment)[0].replace(f.whiteSpace,"").replace(f.commentFlag,"").replace(/\n/g,"");o=a(c)}var s=r.replace(f.comment,"").replace(/\n/g,"").replace(/\{|\}/g,"");return i=a(s),{options:o,style:i}}function a(e){var t={},n=c(e,";");return n.forEach(function(e){var n=c(e,":");t[n[0].replace(f.bothWhiteSpace,"")]=n[1].replace(f.bothWhiteSpace,"")}),t}var s=[];e=e||"",e=e.replace(/\r\n|[\r\u2028\u2029]/g,"\n");var u=-1,l=void 0,f={};f.comment=/\/\*[\s\S]+?\*\/|\/\/.+?\n/,f.commentFlag=/\/\/|\/\*|\*\//g,f.ruleOptionInComment=/\{\{(.+?)\}\}/,f.bothWhiteSpace=/^\s+|\s+$/,f.whiteSpace=/\s/g,f.selector=/([\s\S]+?)\{/,f.allRules=/(\{[\s\S]+?\})/;var p=["a","abbr","acronym","address","applet","area","article","aside","audio","b","base","basefont","bdi","bdo","bgsound","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","command","content","data","datalist","dd","del","details","dfn","dialog","dir","div","dl","dt","element","em","embed","fieldset","figcaption","figure","font","footer","form","frame","frameset","head","header","hgroup","hr","html","i","iframe","image","img","input","ins","isindex","kbd","keygen","label","legend","li","link","listing","main","map","mark","marquee","menu","menuitem","meta","meter","multicol","nav","nobr","noembed","noframes","noscript","object","ol","optgroup","option","output","p","param","picture","plaintext","pre","progress","q","rp","rt","rtc","ruby","s","samp","script","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","title","tr","track","tt","u","ul","var","video","wbr","xmp"],h=["*",".","#","[",":"],m=[];for(m=[].concat(h),p.forEach(function(e){var t=e.substr(0,1);m.includes(t)||m.push(t)}),t();;){if(!l)break;"/"!==l||"*"!==n()&&"/"!==n()?m.includes(l)?o():t():r()}return s}function t(e){return document.querySelector(e)}function n(e,t,n){var r=document.createElement(e),i=void 0;for(i in t)t.hasOwnProperty(i)&&r.setAttribute(i,t[i]);return n&&o(r,n),r}function r(e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];n.forEach(function(t){e.appendChild(t)})}function o(e,t){i(t,0,e)}function i(e,t){for(var n=arguments.length,r=Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];r.forEach(function(n){t?"string"==typeof n.textContent?n.textContent=e:n.innerText=e:n.innerHTML=e})}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var c=function(e,t){t=t||"";var n=e.split(t),r=[];return n.forEach(function(e){""!==e&&r.push(e)}),r},s=function(e){return new Promise(function(t,n){setTimeout(function(){t()},parseInt(e))})},u=function(e){return JSON.parse(JSON.stringify(e))},l=function(){return new Promise(function(e,t){e()})},f=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),p={speed:50,delay:0},h=function(){function i(e){a(this,i),this.options=e||{},this.source=this.options.source||"",this.codeCon=this.options.codeCon||!1,this._paused=!1,this._formatedArray=[],this._index=0,this.format()}return f(i,[{key:"_assignPrintOption",value:function(e){return Object.assign(u(p),e)}},{key:"_handlerComment",value:function(e,t){var n=this,r=this._assignPrintOption(e.options);l().then(function(){return s(r.delay)}).then(function(){return n._print(e)}).then(function(){t()})}},{key:"_handlerCommon",value:function(e,t){var n=this,r=this._assignPrintOption(e.options);l().then(function(){return s(r.delay)}).then(function(){return n._print(e)}).then(function(){t()})}},{key:"_applyStyle",value:function(e,i,a){t("#Magicss-style-con")||r(t("head"),n("style",{id:"Magicss-style-con"}));var c=t("#Magicss-style-con"),s=c.innerHTML;o(c,s+=e+"{"+i+":"+a+"}")}},{key:"_insertElement",value:function(e){var t=n("span",{class:e});return r(this.codeCon,t),t}},{key:"_print",value:function(e,t){var n=this;return new Promise(function(t,r){"comment"===e.type?!function(){var r=n._assignPrintOption(e.options);l().then(function(){var t=c(e.comment,""),o=n._insertElement("comment");return n._writeCharacterArrToEle(o,t,r.speed)}).then(function(){var e=["\n\n"],t=n.codeCon;return n._writeCharacterArrToEle(t,e,r.speed)}).then(function(){t()})}():"common"===e.type&&!function(){var r=n._assignPrintOption(e.options);l().then(function(){var t=c(e.selector,""),o=n._insertElement("selector");return n._writeCharacterArrToEle(o,t,r.speed)}).then(function(){var e=[" ","{","\n"],t=n.codeCon;return n._writeCharacterArrToEle(t,e,r.speed)}).then(function(){var t=Object.keys(e.style),o=0;return new Promise(function(i,a){var s=function a(){if(o>=t.length)return void i();var s=n.codeCon;n._writeCharacterArrToEle(s,[" "," "," "," "],r.speed).then(function(){var e=c(t[o],""),i=n._insertElement("key");return n._writeCharacterArrToEle(i,e,r.speed)}).then(function(){return n._writeCharacterArrToEle(s,[":"," "],r.speed)}).then(function(){var i=c(e.style[t[o]],""),a=n._insertElement("value");return n._writeCharacterArrToEle(a,i,r.speed)}).then(function(){return n._applyStyle(e.selector,t[o],e.style[t[o]]),n._writeCharacterArrToEle(s,[";","\n"],r.speed)}).then(function(){o++,a()})};s()})}).then(function(){var e=["}","\n\n"],t=n.codeCon;return n._writeCharacterArrToEle(t,e,r.speed)}).then(function(){t()})}()})}},{key:"_writeCharacterArrToEle",value:function(e,t,n){var r=this;return new Promise(function(i,a){var c=function e(t,n,a){if(r._fixScrollTop(),!n.length)return void i();var c=t.innerHTML;l().then(function(){return s(a)}).then(function(){r._paused?e(t,n,a):(o(t,c+=n[0]),n.splice(0,1),e(t,n,a))})};c(e,t,n)})}},{key:"_fixScrollTop",value:function(){var e=this.codeCon;e.scrollTop=e.scrollHeight}},{key:"init",value:function(){var e=this;if(!this.codeCon)return void console.warn('You should give a real element to options of "codeCon".');if(!(this._index>=this._formatedArray.length)){var t=this._formatedArray[this._index];"comment"===t.type?this._handlerComment(t,function(){e._index++,e.init()}):"common"===t.type&&this._handlerCommon(t,function(){e._index++,e.init()})}}},{key:"format",value:function(){return this._formatedArray=e(this.source),this._formatedArray}},{key:"setOptions",value:function(e){this.constructor(e),this.init()}},{key:"pause",value:function(){this._paused=!0}},{key:"continue",value:function(){this._paused=!1}},{key:"toggle",value:function(){this._paused=!this._paused}}]),i}();return h});